# Readme
* コンテナの振り分け設定に以下を追加します。
  * 【不浄】は入れない
  * 【人肉】は入れない
  * 腐敗が進まないアイテムのみ入れる

# ソースコード解説

なかなか色々とトリッキーなことをやっています。  
処理の本体は AddFoodDistribution.cs です。  

* コンテナ振り分けメニューへの専用トグルの追加
  * 処理的に適したフック箇所が無かったので、もうContextMenuのAddToggleをフックしました。
  * AddToggleで特定の文字列が降ってきたらついでに自分のも追加させてもらう、みたいなノリです。
  * 重かったらすいません。メニュー表示時しか走らないはずなのでまあ、許されるレベルになる想定です。 
* 各関数とstatic変数
  * 適したフック箇所が見つからなかったので各関数のネストを追って、ネストの頭でstatic変数に一時値を保持したりしてます。
  * 一応処理は追ってみたんですが、予期しない呼び出し順などがあったら死にます。あったらすいません。
* ローカル関数への対処
  * C#では関数内に関数を作ることが出来て、それをローカル関数といいます。
  * 大体コンパイラが静的に適当なメソッド名をつけるので、HarmonyPatchで愚直に呼び出すと流石に変更に弱い状態になります。
  * 今回ThingContainer.GetDest().TrySearchContiner()というローカル関数をどうしてもフックする必要がありました。
  * 幸いHarmonyにはMethodInfoを入れて直にSystem.Actionなどをパッチとして呼び出す機構が存在しています。
  * 今回はそれを使ってみました。
  * AddFoodDistribution.ApplyPatch() がパッチを当てている処理になります。
  * 